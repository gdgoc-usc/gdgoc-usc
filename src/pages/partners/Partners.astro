---
import { Image } from 'astro:assets';
import { supporters } from '@/config/supporters.data';
import SupporterSkeleton from '@/components/skeleton/SupporterSkeleton';
---

<section
  id='partners'
  class='relative flex min-h-screen w-full flex-col items-center overflow-hidden bg-white py-12 dark:bg-gray-900'
>
  <div class='absolute inset-0 opacity-20 dark:opacity-10'>
    <div
      class='absolute inset-0'
      style='background-image: radial-gradient(circle at 2px 2px, rgba(22, 22, 24, 0.3) 1px, transparent 0); background-size: 40px 40px;'
    >
    </div>
  </div>

  <div class='relative z-10 container w-full max-w-7xl px-4 sm:px-6 lg:px-8'>
    <div class='my-12 text-center'>
      <div class='flex justify-center sm:md:lg:xl:mb-4'>
        <Image
          src='/gdgoc_logo.svg'
          alt='GDGoC Logo'
          width={80}
          height={80}
          class='h-24 w-24 md:h-20 md:w-20'
        />
      </div>
      <div class='flex flex-col gap-4'>
        <h1
          class='mb-4 text-4xl font-bold tracking-tighter text-black md:text-6xl dark:text-white'
        >
          Partners that have supported us
        </h1>
        <p
          class='mx-auto max-w-3xl text-xl leading-relaxed text-gray-600 dark:text-gray-300'
        >
          We're grateful for the organizations, sponsors and partners that
          support our mission to build a thriving developer community at USC.
        </p>
      </div>
    </div>
  </div>

  <div class='relative z-10 container w-full max-w-7xl px-4 sm:px-6 lg:px-8'>
    <div
      id='supporters-grid'
      class='grid auto-rows-auto grid-cols-2 gap-2 sm:grid-cols-3 sm:gap-6 md:grid-cols-4 lg:grid-cols-6'
    >
      <div id='skeleton-loader' class='contents'>
        {
          Array.from({ length: supporters.length }).map(() => (
            <SupporterSkeleton client:load />
          ))
        }
      </div>
      <div
        id='supporters-content'
        class='contents opacity-0 transition-opacity duration-500'
      >
        {
          supporters.map(supporter => (
            <div class='flex items-center justify-center rounded-lg border-2 border-black bg-white p-4 shadow-sm transition-all duration-300 hover:shadow-md dark:border-gray-700'>
              <Image
                src={supporter.logo}
                width={120}
                height={120}
                class='h-32 w-32 cursor-pointer object-contain transition-transform duration-300 hover:scale-105'
                alt={supporter.alt}
                data-supporter-name={supporter.name}
              />
            </div>
          ))
        }
      </div>
    </div>

    <div
      id='tooltip'
      class='pointer-events-none fixed z-50 rounded-lg border-2 border-black bg-white px-3 py-2 text-lg whitespace-nowrap text-black opacity-0 transition-opacity duration-200 dark:border-gray-700 dark:bg-gray-800 dark:text-white'
    >
    </div>
  </div>
</section>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function () {
    const tooltip = document.getElementById('tooltip');
    const skeletonLoader = document.getElementById('skeleton-loader');
    const supportersContent = document.getElementById('supporters-content');
    const images = document.querySelectorAll('[data-supporter-name]');

    if (!tooltip) return;

    let loadedCount = 0;
    const totalImages = images.length;

    function showContent() {
      if (skeletonLoader) {
        skeletonLoader.style.display = 'none';
      }
      if (supportersContent) {
        supportersContent.classList.remove('opacity-0');
        supportersContent.classList.add('opacity-100');
      }
    }

    if (totalImages === 0) {
      showContent();
      return;
    }

    images.forEach(function (image) {
      if (image.complete) {
        loadedCount++;
        if (loadedCount === totalImages) {
          setTimeout(showContent, 300);
        }
      } else {
        image.addEventListener('load', function () {
          loadedCount++;
          if (loadedCount === totalImages) {
            setTimeout(showContent, 300);
          }
        });

        image.addEventListener('error', function () {
          loadedCount++;
          if (loadedCount === totalImages) {
            setTimeout(showContent, 300);
          }
        });
      }

      image.addEventListener('mouseenter', function (e) {
        const target = e.target;
        if (!target) return;

        const supporterName = target.getAttribute('data-supporter-name');
        if (supporterName) {
          tooltip.textContent = supporterName;
          tooltip.style.opacity = '1';
        }
      });

      image.addEventListener('mouseleave', function () {
        tooltip.style.opacity = '0';
      });

      image.addEventListener('mousemove', function (e) {
        const tooltipRect = tooltip.getBoundingClientRect();
        const x = e.clientX + 10;
        const y = e.clientY - tooltipRect.height - 10;

        tooltip.style.left = x + 'px';
        tooltip.style.top = y + 'px';
      });
    });

    setTimeout(showContent, 3000);
  });
</script>
